<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="VantaSpeech.Views.LibraryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:VantaSpeech.Views"
    xmlns:models="using:VantaSpeech.Models"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="Page_Loaded">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Search bar -->
        <AutoSuggestBox
            x:Name="SearchBox"
            Grid.Row="0"
            PlaceholderText="Search recordings..."
            QueryIcon="Find"
            Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay}"
            Margin="0,0,0,16" />

        <!-- Empty state -->
        <StackPanel
            Grid.Row="1"
            VerticalAlignment="Center"
            HorizontalAlignment="Center"
            Visibility="{x:Bind ViewModel.IsEmpty, Mode=OneWay}">
            <FontIcon
                Glyph="&#xE720;"
                FontSize="64"
                Foreground="{ThemeResource SystemFillColorNeutralBrush}" />
            <TextBlock
                Text="No recordings yet"
                Style="{StaticResource SubtitleTextBlockStyle}"
                Margin="0,16,0,8"
                HorizontalAlignment="Center" />
            <TextBlock
                Text="Tap the record button to start"
                Foreground="{ThemeResource SystemFillColorNeutralBrush}"
                HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Recordings list -->
        <ScrollViewer
            Grid.Row="1"
            Visibility="{x:Bind ViewModel.IsEmpty, Mode=OneWay, Converter={StaticResource BoolToVisibilityInverseConverter}}">
            <StackPanel Spacing="16">
                <!-- Recent recording card -->
                <TextBlock
                    Text="Recent"
                    Style="{StaticResource SubtitleTextBlockStyle}"
                    Visibility="{x:Bind ViewModel.RecentRecording, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}" />

                <Border
                    Background="{StaticResource CardGradientBrush}"
                    CornerRadius="12"
                    Padding="20"
                    Visibility="{x:Bind ViewModel.RecentRecording, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <FontIcon
                            Grid.Column="0"
                            Glyph="&#xE9B1;"
                            Foreground="White"
                            FontSize="24"
                            Margin="0,0,16,0" />

                        <StackPanel Grid.Column="1">
                            <TextBlock
                                Text="{x:Bind ViewModel.RecentRecording.Title, Mode=OneWay}"
                                Foreground="White"
                                FontWeight="SemiBold"
                                FontSize="16" />
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock
                                    Text="{x:Bind ViewModel.RecentRecording.FormattedDate, Mode=OneWay}"
                                    Foreground="White"
                                    Opacity="0.7"
                                    FontSize="12" />
                                <TextBlock
                                    Text=" • "
                                    Foreground="White"
                                    Opacity="0.7"
                                    FontSize="12" />
                                <TextBlock
                                    Text="{x:Bind ViewModel.RecentRecording.FormattedDuration, Mode=OneWay}"
                                    Foreground="White"
                                    Opacity="0.7"
                                    FontSize="12" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- All recordings -->
                <ListView
                    ItemsSource="{x:Bind ViewModel.Recordings, Mode=OneWay}"
                    SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:Recording">
                            <Border
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8"
                                Padding="16"
                                Margin="0,4">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Border
                                        Grid.Column="0"
                                        Background="{ThemeResource AccentFillColorDefaultBrush}"
                                        CornerRadius="8"
                                        Width="40"
                                        Height="40"
                                        Margin="0,0,12,0">
                                        <FontIcon
                                            Glyph="&#xE9B1;"
                                            Foreground="White"
                                            FontSize="20"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                                    </Border>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock
                                            Text="{x:Bind Title}"
                                            FontWeight="Medium"
                                            TextTrimming="CharacterEllipsis" />
                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                            <TextBlock
                                                Text="{x:Bind FormattedDate}"
                                                Foreground="{ThemeResource SystemFillColorNeutralBrush}"
                                                FontSize="12" />
                                            <TextBlock
                                                Text=" • "
                                                Foreground="{ThemeResource SystemFillColorNeutralBrush}"
                                                FontSize="12" />
                                            <TextBlock
                                                Text="{x:Bind FormattedDuration}"
                                                Foreground="{ThemeResource SystemFillColorNeutralBrush}"
                                                FontSize="12" />
                                        </StackPanel>
                                    </StackPanel>

                                    <Button
                                        Grid.Column="2"
                                        Style="{StaticResource IconButtonStyle}">
                                        <FontIcon Glyph="&#xE712;" FontSize="16" />
                                        <Button.Flyout>
                                            <MenuFlyout>
                                                <MenuFlyoutItem Text="Rename" Icon="Rename" />
                                                <MenuFlyoutItem Text="Delete" Icon="Delete" />
                                            </MenuFlyout>
                                        </Button.Flyout>
                                    </Button>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
        </ScrollViewer>

        <!-- Loading indicator -->
        <ProgressRing
            Grid.Row="1"
            IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
            Width="40"
            Height="40"
            HorizontalAlignment="Center"
            VerticalAlignment="Center" />
    </Grid>
</Page>
